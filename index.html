<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kontroller - POC</title>
    <link href="css/main.css" rel="stylesheet">
    <link href="css-lib/bootstrap-theme.min.css" rel="stylesheet">
    <link href="css-lib/bootstrap.min.css" rel="stylesheet">
    <script src="js/lib/jquery-2.1.3.js"></script>
    <script src="js/lib/bootstrap.min.js"></script>
    <script src="js/lib/handlebars-v3.0.1.js"></script>
    <script src="js/lib/underscore-1.8.3.js"></script>
    <script src="js/lib/backbone-min-1.1.2.js"></script>
</head>
<body role="document" id="body">

<script id="home-template" type="text/x-handlebars-template">
    <h1>Home Page</h1>
    {{ greeting}}
</script>

<script id="kafka-template" type="text/x-handlebars-template">
    <h1>Kafka Page</h1>
    {{content}}
</script>

<script id="kaboom-template" type="text/x-handlebars-template">
    <h1>KaBoom Page</h1>
    {{content}}
</script>

<script id="kaboom-config-template" type="text/x-handlebars-template">
    <h1>KaBoom Running Configuration Page</h1>
    <br />
    <p>This configuration will take affect immediately and affect all running KaBoom clients</p>
    <p><strong><i>EDITING:</i></strong> To edit a field, double-click the value.</p>
    {{>kaboom-running-config-form-template runningConfig}}
</script>

<script id="header-nav-bar-template" type="text/x-handlebars-template">
    <nav id="top-header-nav-bar" class="navbar navbar-inverse">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <!--<a class="navbar-brand" href="/#">Kontroller</a>-->
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    {{#each menuItems}}
                        {{#if subMenu}}
                            <li class="dropdown" id="headerMenu_{{link}}">
                                <a href="#" class="dropdown-toggle"
                                   data-toggle="dropdown"
                                   role="button"
                                   aria-expanded="false">{{title}}<span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu" role="menu">
                                    {{#each subMenu}}
                                        <li id="headerMenu_{{link}}"><a href="#{{link}}">{{title}}</a></li>
                                    {{/each}}
                                </ul>
                            </li>
                        {{else}}
                            <li id="headerMenu_{{link}}"><a href="#{{link}}">{{title}}</a></li>
                        {{/if}}
                    {{/each}}
                </ul>
            </div>
        </div>
    </nav>
</script>

<script id="editable-ro-text-input" type="text/x-handlebars-template">
    <input readonly
           class="disabledTextInput"
           type="text"
           ondblclick="enableTextInput(this)"
           onblur="disableTextInput(this)"
           onkeypress="textInputKeypress(this, event)"
           id="{{indexed-array-id id array index}}"
           name="{{indexed-array-id id array index}}"
           value="{{value}}" />
</script>

<script id="editable-ro-checkbox" type="text/x-handlebars-template">
    <div class="disabledTextInput" id="div-{{indexed-array-id id array index}}">
        <input readonly
               class="disabledCheckbox"
               type="checkbox"
               onclick="return false"
               ondblclick="enableCheckbox(this, 'div-{{indexed-array-id id array index}}')"
               onblur="disableCheckbox(this, 'div-{{indexed-array-id id array index}}')"
               id="{{indexed-array-id id array index}}"
               name="{{indexed-array-id id array index}}"
               {{{checkedBoxFromBool bool }}}/>
    </div>
</script>

<script>
    Handlebars.registerHelper('indexed-array-id', function(id, array, index) {
        var finalId = "";
        if (array) {
            if (index) {
                finalId = finalId + array + "[" + index+"][" + id + "]";
            } else {
                finalId = finalId + array + "[" + id + "]";
            }
        } else {
            finalId = finalId + id;
        }
        return finalId;
    });
</script>

<script id="kaboom-running-config-form-template" type="text/x-handlebars-template">
    <h4><strong>Running Config Version: <span class="badge">{{version}}</span></strong></h4>

    <table class="table table-striped table-nonfluid" width="">
        <tr>
            <td>{{>editable-ro-text-input id="readyFlagPrevHoursCheck" value=readyFlagPrevHoursCheck}}</td>
            <td><label for="readyFlagPrevHoursCheck">Num Previous Hours for Ready Flag Checks</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="leaderSleepDurationMs" value=leaderSleepDurationMs}}</td>
            <td><label for="leaderSleepDurationMs">Leader Sleep Duration (ms)</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="compressionLevel" value=compressionLevel}}</td>
            <td><label for="compressionLevel">Compression Level</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="boomFileBufferSize" value=boomFileBufferSize}}</td>
            <td><label for="boomFileBufferSize">Boom File Buffer Size</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="boomFileReplicas" value=boomFileReplicas}}</td>
            <td><label for="boomFileReplicas">Boom File Replicas</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="boomFileBlocksize" value=boomFileBlocksize}}</td>
            <td><label for="boomFileBlocksize">Boom File Block Size</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="boomFileTmpPrefix" value=boomFileTmpPrefix}}</td>
            <td><label for="boomFileTmpPrefix">Boom File Temp Prefix</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="periodicHdfsFlushInterval" value=periodicHdfsFlushInterval}}</td>
            <td><label for="periodicHdfsFlushInterval">Periodic HDFS Flush Interval (ms)</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="periodicFileCloseInterval" value=periodicFileCloseInterval}}</td>
            <td><label for="periodicFileCloseInterval">Periodic File Close Check Interval (ms)</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="kaboomServerSleepDurationMs" value=kaboomServerSleepDurationMs}}</td>
            <td><label for="kaboomServerSleepDurationMs">KaBoom Server Sleep Duration (ms)</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="fileCloseGraceTimeAfterExpiredMs" value=fileCloseGraceTimeAfterExpiredMs}}</td>
            <td><label for="fileCloseGraceTimeAfterExpiredMs">Grace Time After Expired File Before Closing (ms)</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="forcedZkOffsetTsUpdateMs" value=forcedZkOffsetTsUpdateMs}}</td>
            <td><label for="forcedZkOffsetTsUpdateMs">Forced ZK Offset Timestamp Delay (ms)</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-text-input id="kafkaReadyFlagFilename" value=kafkaReadyFlagFilename}}</td>
            <td><label for="kafkaReadyFlagFilename">Ready Flag Writer Flag FileName</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-checkbox id="sinkToHighWatermark" bool=sinkToHighWatermark}}</td>
            <td><label for="sinkToHighWatermark">Sink to High Watermark:</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-checkbox id="allowOffsetOverrides" bool=allowOffsetOverrides}}</td>
            <td><label for="allowOffsetOverrides">Offset Overrides:</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-checkbox id="useTempOpenFileDirectory" bool=useTempOpenFileDirectory}}</td>
            <td><label for="useTempOpenFileDirectory">Use Temp Open File Dirs:</label></td>
        </tr>
        <tr>
            <td>{{>editable-ro-checkbox id="useNativeCompression" bool=useNativeCompression}}</td>
            <td><label for="useNativeCompression">Use Native Compression:</label></td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>
                <button class="save">Save</button> &nbsp;
                <button class="cancel">Cancel</button>
            </td>
        </tr>
    </table>
</script>

<script id="kaboom-topic-template" type="text/x-handlebars-template">
    {{>kaboom-topic-list-template topics=topics}}
    <div>Click any topic to the left to edit it's configuration</div>
</script>

<script id="kaboom-topic-edit-template" type="text/x-handlebars-template">
    {{>kaboom-topic-list-template topics=topics}}
    {{>kaboom-topic-edit-form-template currentTopic.attributes}}
</script>

<script id="kaboom-topic-list-template" type="text/x-handlebars-template">
    <div class="col-sm-3">
        <div class="list-group">
            {{#each topics}}
            <a id="{{id}}" class="list-group-item" href='#kaboom-topics/{{id}}'>{{id}}</a>
            {{/each}}
        </div>
    </div>
</script>

<script id="kaboom-topic-edit-form-template" type="text/x-handlebars-template">
    <div class="col-sm-5">
        <h2 style="margin-top: 0px;">{{id}}</h2>
        <p>Topic Config Version: <span class="badge">{{version}}</span></p>
        <table class="table table-striped table-nonfluid">
            <tr>
                <td>{{>editable-ro-text-input id="hdfsRootDir" value=hdfsRootDir}}</td>
                <td><label for="hdfsRootDir">HDFS Root Directory</label></td>
            </tr>
            <tr>
                <td>{{>editable-ro-text-input id="proxyUser" value=proxyUser}}</td>
                <td><label for="proxyUser">Proxy User</label></td>
            </tr>
        </table>
        <p>
            There are <span class="badge">{{filterSet.length}}</span> filter(s) configured
            <button type="button" class="btn btn-xs btn-primary addFilter">Add Filter</button>
        </p>
        {{#each filterSet}}
            {{>kaboom-topic-filter-form-template filter=attributes numFilters=../filterSet.length}}
        {{/each}}
        <button class="save">Save</button> &nbsp;
        <button class="cancel">Cancel</button>
    </div>
</script>

<script id="topic-filter-mgmt-butons" type="text/x-handlebars-template">
    {{{drawMoveUp filter}}}
    {{{drawMoveDown filter numFilters}}}
    <button value="{{filter.number}}" type="button" class="btn btn-default btn-sm filterRemove" >
        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
    </button>
</script>


<script id="kaboom-topic-filter-form-template" type="text/x-handlebars-template">
    <hr>
    <div>
        <p><strong>Filter #{{filter.number}}</strong> &nbsp; {{>topic-filter-mgmt-butons numFilters=numFilters filter=filter}}</p>
        <table class="table table-striped table-nonfluid">
            <tr>
                <td>{{>editable-ro-text-input id="name" value=filter.name array="filterSet" index=filter.number}}</td>
                <td><label for="filterSet[{{filter.number}}][name]">Filter Name</label></td>
            </tr>
            <tr>
                <td>{{>editable-ro-text-input id="type" value=filter.type array="filterSet" index=filter.number}}</td>
                <td><label for="filterSet[{{filter.number}}][type]">Filter Type</label></td>
            </tr>
            <tr>
                <td>{{>editable-ro-text-input id="filter" value=filter.filter array="filterSet" index=filter.number}}</td>
                <td><label for="filterSet[{{filter.number}}][filter]">Filter Value</label></td>
            </tr>
            <tr>
                <td>{{>editable-ro-text-input id="duration" value=filter.duration array="filterSet" index=filter.number}}</td>
                <td><label for="filterSet[{{filter.number}}][filter]">Duration</label></td>
            </tr>
            <tr>
                <td>{{>editable-ro-text-input id="directory" value=filter.directory array="filterSet" index=filter.number}}</td>
                <td><label for="filterSet[{{filter.number}}][directory]">Directory</label></td>
            </tr>
            <tr>
                <td>{{>editable-ro-checkbox id="filterIntentionIsToMatch" bool=filter.filterIntentionIsToMatch array="filterSet" index=filter.number}}</td>
                <td><label for="filterSet[{{filter.number}}][filterIntentionIsToMatch]">Filter's Intention is to Match?</label></td>
            </tr>
        </table>
    </div>
</script>

<div id="header-container"></div>
<div class="container" id="content-container"></div>
<script src="js/utils.js"></script>
<script src="js/views/HomeView.js"></script>
<script src="js/views/KaBoomView.js"></script>
<script src="js/views/KafkaView.js"></script>
<script src="js/views/KaBoomRunningConfig.js"></script>
<script src="js/views/KaBoomTopicEdit.js"></script>
<script src="js/views/KaBoomTopicList.js"></script>
<script src="js/menu.js"></script>
<script src="js/main.js"></script>
</body>
</html>